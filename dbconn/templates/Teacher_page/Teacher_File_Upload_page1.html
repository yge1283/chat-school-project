<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher_Homework_Make_with_AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="stylesheet" href="{{ url_for('static', filename='./css/Style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
  
    <!-- 메뉴바 목록 아이콘 색깔떄문에 일단 넣어두었음.  -->
    
</head>


<style>

    body{
        font-family: "Jua", sans-serif;
        font-weight: 100;
    }
    
    
        .hidden-file-input {
          display: none;
        }
    
        .custom-button {
          display: inline-block;
          padding: 10px;
          background-color: #ffffff;
          color: rgb(0, 0, 0);
          border: 1px solid black;
          cursor: pointer;
          border-radius: 5px;
          white-space: nowrap;
          font-size: 15px;
          height: 45px; /* 버튼 높이 설정 */
          box-sizing: border-box;
        }
    
        .file-item {
          cursor: pointer;
          margin: 0px auto;
          white-space: nowrap;
          text-overflow: ellipsis;
          font-size: 16px;
          display: flex;
          justify-content: center;
          align-items: center;
        }
    
        .image-display {
          max-width: 100%;
          height: auto;
          margin: 0px auto;
          display: flex;
          justify-content: center;
          align-items: center;
        }
    
        .container1 {
          display: flex;
          flex-direction: column;
          width: 50vw;
          max-width: 1200px;
          margin: 0 auto;
        }
    
        /* 파일 목록 칸 길이 */
        .part {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 40vw;
          height: 10vw;
          margin: 0px auto;
        }
    
        .box {
          border: 1px solid #ccc;
          border-radius: 5px;
          padding: 20px;
          margin-bottom: 0px;
          background-color: white;
        }
    
        .box-1 {
          flex: 1;
          height: 5vw; /* 파일 선택 버튼과 동일한 높이 설정 */
          overflow: hidden; /* 높이 제한 설정 */
          overflow-y: auto;
          margin-left: 20px; /* 파일 선택 버튼과의 간격 */
          display: flex;
          justify-content: center;
          align-self: center;
        }
    
        .box-3 {
          width: 100%;
          height: 300px;
          overflow: hidden;
          overflow-y: auto;
        }
    
        /* 문제 보기 */
        .problem_view {
          margin-top: 50px;
        }
    
        @media (max-width: 768px) {
          .container1 {
            flex-direction: column;
            align-items: center;
          }
          .part {
            align-items: flex-start;
          }
          .box-1 {
            margin-top: -0.5vw;
          }
          .box-3 {
            width: 100%;
          }
        }


</style>


<header>

<!--  -->
<header class="p-3 mb-3 border-bottom gradient-background">
    <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
        <a href="/"
            class="d-flex align-items-center mb-2 mb-lg-0 link-body-emphasis text-decoration-none">
            <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap">
                <use xlink:href="#bootstrap"></use>
            </svg>
        </a>

        <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
            <nav class="navbar navbar-light" aria-label="light offcanvas navbar">
                <div class="container-fluid">
                    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar"
                        aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1"
                        id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                        <div class="offcanvas-header">
                            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">이전 과제 문제 (날짜 빠른순이 위로)
                            </h5>
                            <button type="button" class="btn-close btn-close-white"
                                data-bs-dismiss="offcanvas" aria-label="Close"></button>
                        </div>
                        <div class="offcanvas-body" style="background-color: white;">
                            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                                <li class="nav-item">
                                    <a class="nav-link active" aria-current="page" href="#">1.이전 과제 문제
                                    </a>
                                </li>
                            </ul>
                            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                                <li class="nav-item">
                                    <a class="nav-link active" aria-current="page" href="#">2.이전 과제 문제
                                    </a>
                                </li>
                            </ul>
                            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                                <li class="nav-item">
                                    <a class="nav-link active" aria-current="page" href="#">3.이전 과제 문제
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        
        <li><a class="nav-link px-3 link-body-emphasis" href="{{ url_for('teacher_main.show_teacher_DashboardPage') }}">홈</a></li>

        <div class="dropdown text-end">                            
          <a href="#" class="nav-link link-body-emphasis text-decoration-none dropdown-toggle"
              data-bs-toggle="dropdown" aria-expanded="false">과제
          </a>
          <ul class="dropdown-menu" data-bs-popper="static">
                <li><a class="dropdown-item" href="{{ url_for('teacher_main.show_teacher_homeworkPage') }}">과제 확인</a></li>
                <li><a class="dropdown-item" href="{{ url_for('teacher_main.show_teacher_homeworkMakeWithAIPage') }}">AI 문제 생성</a></li>
          </ul>
        </div>

        <li><a class="nav-link px-3 link-body-emphasis" href="{{ url_for('teacher_main.show_teacher_questionPage') }}">질문 게시판</a></li>
        <li><a class="nav-link px-3 link-body-emphasis" href="{{ url_for('teacher_main.show_student_mind') }}">감정 분석</a></li>
        <div class="dropdown text-end">
            <a href="#" class="nav-link link-body-emphasis text-decoration-none dropdown-toggle"
                data-bs-toggle="dropdown" aria-expanded="false">기타사항
            </a>
            <ul class="dropdown-menu" data-bs-popper="static">
                <li><a class="dropdown-item" href="#">오늘의 학습</a></li>
                <li><a class="dropdown-item" href="#">파일 올리기</a></li>
                <li><a class="nav-link px-3 link-body-emphasis" href="{{ url_for('teacher_main.show_teacher_memoPage') }}">메모장</a></li>
            </ul>
        </div>
    </ul>

    <ul class="nav navbar-nav navbar-right">
        <li><a href="#" class="px-3">로그아웃</a></li>
    </ul>

     <!-- 프로필 버튼 -->
    <div class="dropdown text-end">
        <a href="#" class="d-block link-body-emphasis text-decoration-none" data-bs-toggle="offcanvas" data-bs-target="#profileOffcanvas" aria-controls="profileOffcanvas"> <!-- 오프캔버스를 열도록 설정 -->
            <img src="https://github.com/mdo.png" alt="프로필 이미지" width="32" height="32"
                class="rounded-circle">
        </a>
    </div>
    
    <!-- 프로필 오프캔버스 -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="profileOffcanvas" aria-labelledby="profileOffcanvasLabel"> <!-- 오른쪽 오프캔버스 -->
        <div class="offcanvas-header">
            <h5 id="profileOffcanvasLabel">프로필</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button> <!-- 닫기 버튼 -->
        </div>
        <div class="offcanvas-body"> <!-- 오프캔버스 내용 -->
            <p>프로필 정보가 여기에 표시됩니다.</p> <!-- 예시 내용 -->
        </div>
    </div>
</div>
</header>
</header>
  

<body>

    
        <div class="total" style="top: 500px;">
          
           

            <div class="container1" >

               

                


                <!-- 버튼, 파일목록 나오는 칸, 파일 프리뷰 나오는 칸 시작  -->
                  <div class="part"  >
                     <!-- <input type="date" id="FileUploadDate" name="date" style="width: 120px;height: 30px;
                    position: relative;left: 350px; " >  -->
                    
                  
                      <!-- 파일 올리기 버튼 -->
                       
                      <input type="file" id="fileInput" class="hidden-file-input btn btn-outline-dark" multiple>
                      <button class="custom-button" onclick="document.
                      getElementById('fileInput').click();">파일 선택</button>
    
                  
                      

                     
 
    <div class="box box-1">
        <div class="file-list" id="fileList"></div>
      </div>
    </div>
    <div class="box box-3">
      <div class="preview_img image-display"></div>
      <div class="file-content" id="fileContent" style="overflow: hidden;"></div>
    </div>
                   



                      
    
                   
            

              
                 


               
               <!-- <div style="display: flex;align-items: center;justify-content: center;position: relative;left: 0px;">
                   <a  href="{{ url_for('teacher_main.viewtest') }}">
                   <button id="writeButton" type="button" class="btn btn-outline-dark problem_view" 
                    >문제보기</button>
                
                
                    </a> -->

                  



                    <button id="writeButton submutBtn" type="button"
                     style="border: 1px solid black; width: 100px;
                      border-radius: 7px;margin-left: 45% ;position: relative; top: 23px;" 
                      
                      class="btn btn-outline-dark submit" onclick="uploadFile()"
                    >업로드</button>
                    
                   
                
           </div>





                     <!-- 본문 내용 시작 -->
                      <!-- <div class="box box-2">
                        <div class="card shadow-sm" style="height: 450px; width: 380px;"> 
                            <div class="d-flex flex-column justify-content-start align-items-center border p-2" style="background-color: rgb(228, 247, 255);"> 
                                <p class="mb-0" style="font-weight: 100;">
                                    본문 내용
                                </p> 
                            </div>
                            <textarea id="textContent" style="height: 400px; border: 1px si;"> </textarea>
                        </div>
                      </div> -->
                      <!-- 본문 내용 끝 -->

           
            </div>
            


                     
         </div>


      
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script>

        const fileInput1 = document.getElementById('fileInput');
            const fileList = document.getElementById('fileList');
            const fileContent = document.getElementById('fileContent');
        
            fileInput1.addEventListener('change', handleFileUpload);
        
            function handleFileUpload(event) {
                const files = event.target.files;
                fileList.innerHTML = ''; // Clear the file list container
                Array.from(files).forEach(file => {
                    const listItem = document.createElement('div');
                    listItem.textContent = file.name;
                    listItem.classList.add('file-item');
                    listItem.addEventListener('click', () => displayFileContent(file));
                    fileList.appendChild(listItem);
                });
            }
        
            function displayFileContent(file) {
                if (file.type.startsWith('image/')) {
                    displayImage(file);
                } else if (file.type.startsWith('text/')) {
                    displayText(file);
                } else if (file.type === 'application/pdf') {
                    displayPdf(file);
                }
            }
        
            function displayImage(file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const content = event.target.result;
                    const image = new Image();
                    image.src = content;
                    image.classList.add('image-display');
                    fileContent.innerHTML = ''; // Clear the file content container
                    fileContent.appendChild(image);
                };
                reader.readAsDataURL(file);
            }
        
            function displayText(file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const content = event.target.result;
                    const pre = document.createElement('pre');
                    pre.textContent = content;
                    pre.style.margin='0px auto'
                    pre.style.fontSize = '16px'; // 글씨 크기 조정
                    pre.style.wordWrap = 'break-word'; // 단어 단위로 줄 바꿈 처리
                    pre.style.whiteSpace = 'pre-wrap'; // 줄 바꿈 처리
                    pre.style.overflow = 'hidden'; // 스크롤 바 없애기
                    pre.style.maxHeight = '100%'; // 컨테이너의 높이를 초과하지 않도록 설정
                    fileContent.innerHTML = ''; // Clear the file content container
                    fileContent.appendChild(pre);
        
                    // 텍스트가 모두 표시될 때까지 컨테이너의 크기를 재조정
                    const resizeObserver = new ResizeObserver(entries => {
                        for (let entry of entries) {
                            if (entry.target === pre) {
                                const containerHeight = entry.contentRect.height;
                                pre.style.maxHeight = `${containerHeight}px`; // 컨테이너의 높이에 맞게 설정
                            }
                        }
                    });
                    resizeObserver.observe(pre);
                };
                reader.readAsText(file);
            }
        
            function displayPdf(file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const content = event.target.result;
                    const pdfjsLib = window['pdfjs-dist/build/pdf'];
                    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    const pdfDoc = pdfjsLib.getDocument(content);
                    pdfDoc.promise.then(pdf => {
                        pdf.getPage(1).then(page => {
                            const viewport = page.getViewport({ scale: 1 });
                            canvas.width = viewport.width;
                            canvas.height = viewport.height;
                            const renderContext = {
                                canvasContext: context,
                                viewport: viewport
                            };
                            page.render(renderContext).promise.then(() => {
                                const image = new Image();
                                image.src = canvas.toDataURL();
                                image.classList.add('image-display');
                                fileContent.innerHTML = ''; // Clear the file content container
                                fileContent.appendChild(image);
                            });
                        });
                    });
                };
                reader.readAsArrayBuffer(file);
            }
          
        
        
        
        
            </script>




<script>


const fsocket=io.connect('/chatbot');

fsocket.emit('first_connect')


function waitForUrl(fsock) {
    return new Promise((resolve) => {
        fsocket.on('get_url',(data) => {
            ai_url = data;
            console.log("ai url 가져옴>> "+ai_url);
            resolve(ai_url);
        });
    });
}


let socket;

(async () => {

    socket = io(await waitForUrl(fsocket), { //받아온 주소로 ai서버연결
        autoConnect: true,
        extraHeaders: {
            "ngrok-skip-browser-warning": true
        },
        path: '/socket.io',
        transports: ['websocket', 'polling'],
        allowEIO3: true
    });

    socket.on('connect', () => {
        console.log('AI서버 Connected .');
    });
    
    socket.on('connect_error', (error) => {
        console.error('Connection Error:', error);
    });
    
    socket.on('error', (error) => {
        console.error('WebSocket Error:', error);
    });
    
    socket.on('disconnect', (reason) => {
        console.log('Disconnected:', reason);
    });
})();

 














    function uploadFile() {
        console.log("실행됨")
        const fileInput = document.getElementById('fileInput'); //파일 입력부분 요소수정 필요시 수정하기
        const file = fileInput.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const arrayBuffer = event.target.result;
                const bytes = new Uint8Array(arrayBuffer);
                socket.emit('make_q', {filename: file.name, data: bytes});
                socket.emit('make_q_2', {filename: file.name, data: bytes});
           
       
            };
            reader.readAsArrayBuffer(file);
        } else {
            alert("Please select a file first."); //파일 선택 안된상태로 업로드누를시 경고
        }
      


       
    

      socket.on('connect',function() {
        console.log("서버 연결됨")
        

       });

    socket.on('upload_response', function(data) { //서버에서 파일 받으면 확인 알림 (나중에 없애도 됨)
        alert(data.message);
        alert("서버에서 데이터 받음")
   

       
       
    });
    socket.on('make_q_result', function(data) { //문제 생성결과 받아옴 data에 들어있음
        

   
    localStorage.setItem('make_q_result', JSON.stringify(data))
    alert("데이터를 받음")
    console.log("받은 데이터 표시함")

   
      
    });


    socket.on('make_q_2_result', function(data) { 
        
   
       
        localStorage.setItem('make_q_2_result',JSON.stringify(data))
        alert("객관식 데이터를 받음")
        console.log("받은 객관식 데이터 표시함")

 
          
        });
    }

  

</script>









    
              
          
        
    

       

   

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>